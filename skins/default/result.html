<load target="css/mbti.css" />

<div class="mbti-premium-container">
    <div class="mbti-result-card mbti-type-{$mbti_result->mbti_type}">
        <div class="result-header">
            <h4>당신의 성격 유형은</h4>
            <h1 class="result-type">{$mbti_result->mbti_type} <span
                    style="font-size:0.6em; color:var(--mbti-secondary-text);">({$mbti_result->mbti_subtype})</span>
            </h1>
            <!--@if($type_info)-->
            <h3 class="result-nickname" style="color:var(--mbti-primary); margin-top:-10px; margin-bottom:15px;">
                "{$type_info->nickname}"</h3>
            <!--@end-->
            <p class="result-date">{zdate($mbti_result->regdate, 'Y년 m월 d일')} 검사 완료</p>
        </div>

        <!--@if($type_info)-->
        <div class="result-desc-box"
            style="background:#f8fafc; padding:20px; border-radius:12px; margin: 20px 0; text-align:left; line-height:1.6; color:var(--mbti-text-main);">
            <p style="margin-bottom:15px;">{$type_info->description}</p>
            <div style="display:flex; gap:10px; font-size:0.9rem;">
                <div style="flex:1; background:#ecfdf5; padding:12px; border-radius:8px;">
                    <strong style="color:#10b981;">👍 환상의 짝꿍</strong><br />
                    {$type_info->good_match}
                </div>
                <div style="flex:1; background:#fef2f2; padding:12px; border-radius:8px;">
                    <strong style="color:#ef4444;">👎 환장의 짝꿍</strong><br />
                    {$type_info->bad_match}
                </div>
            </div>
        </div>
        <!--@end-->

        <div class="result-bars">
            <!-- E vs I -->
            <div class="bar-row">
                <span class="label left">외향 (E)</span>
                <div class="bar-track">
                    {@ $ratio_e = ($mbti_result->score_e / ($mbti_result->score_e + $mbti_result->score_i)) * 100 }
                    {@ $ratio_i = 100 - $ratio_e }
                    <div class="bar-fill e-fill" style="width:{$ratio_e}%"></div>
                    <div class="bar-fill i-fill" style="width:{$ratio_i}%"></div>
                </div>
                <span class="label right">내향 (I)</span>
            </div>

            <!-- S vs N -->
            <div class="bar-row">
                <span class="label left">감각 (S)</span>
                <div class="bar-track">
                    {@ $ratio_s = ($mbti_result->score_s / ($mbti_result->score_s + $mbti_result->score_n)) * 100 }
                    {@ $ratio_n = 100 - $ratio_s }
                    <div class="bar-fill s-fill" style="width:{$ratio_s}%"></div>
                    <div class="bar-fill n-fill" style="width:{$ratio_n}%"></div>
                </div>
                <span class="label right">직관 (N)</span>
            </div>

            <!-- T vs F -->
            <div class="bar-row">
                <span class="label left">사고 (T)</span>
                <div class="bar-track">
                    {@ $ratio_t = ($mbti_result->score_t / ($mbti_result->score_t + $mbti_result->score_f)) * 100 }
                    {@ $ratio_f = 100 - $ratio_t }
                    <div class="bar-fill t-fill" style="width:{$ratio_t}%"></div>
                    <div class="bar-fill f-fill" style="width:{$ratio_f}%"></div>
                </div>
                <span class="label right">감정 (F)</span>
            </div>

            <!-- J vs P -->
            <div class="bar-row">
                <span class="label left">판단 (J)</span>
                <div class="bar-track">
                    {@ $ratio_j = ($mbti_result->score_j / ($mbti_result->score_j + $mbti_result->score_p)) * 100 }
                    {@ $ratio_p = 100 - $ratio_j }
                    <div class="bar-fill j-fill" style="width:{$ratio_j}%"></div>
                    <div class="bar-fill p-fill" style="width:{$ratio_p}%"></div>
                </div>
                <span class="label right">인식 (P)</span>
            </div>
        </div>

        <div class="result-actions" style="margin-top: 30px; display:flex; gap:10px; justify-content:center;">
            <!--@if($is_logged)-->
            <a href="{getUrl('act','dispMbtiIndex', 'result_srl', '')}" class="mbti-btn mbti-btn-secondary">다시 검사하기</a>
            <!--@end-->
            <button class="mbti-btn mbti-btn-primary" onclick="copyMbtiLink()">내 결과 공유하기</button>
        </div>
    </div>
</div>

<script>
    function copyMbtiLink() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            alert("결과 페이지 링크가 복사되었습니다!\n친구들에게 공유해보세요.");
        }).catch(err => {
            alert("링크 복사에 실패했습니다. 수동으로 주소창의 링크를 복사해주세요.");
        });
    }
</script>